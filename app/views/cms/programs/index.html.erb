<div class="cms-header">
  <h1><%= t('cms.title') %></h1>
  <%= link_to t('cms.new_program'), new_cms_program_path, class: "btn" %>
</div>

<div class="programs-grid">
  <% @programs.each do |program| %>
    <div class="program-card">
      <div class="card-image">
        <% if program_has_thumbnail?(program) %>
          <img src="<%= program_thumbnail_url(program) %>" 
               alt="<%= program.title %>" 
               onerror="this.style.display='none'; this.parentNode.querySelector('.placeholder-image').style.display='flex';" />
        <% end %>
        <div class="placeholder-image" style="<%= program_has_thumbnail?(program) ? 'display: none;' : '' %>">
          <% if program.status == 'processing' %>
            <div class="processing-indicator">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <animateTransform attributeName="transform" type="rotate" values="0 12 12;360 12 12" dur="1s" repeatCount="indefinite"/>
                </path>
              </svg>
              <p style="margin-top: 0.5rem; font-size: 0.8rem; color: inherit;"><%= t('status.processing') %>...</p>
            </div>
          <% elsif program.status == 'failed' %>
            <div class="error-indicator">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="#DC3545" stroke-width="2"/>
                <line x1="15" y1="9" x2="9" y2="15" stroke="#DC3545" stroke-width="2"/>
                <line x1="9" y1="9" x2="15" y2="15" stroke="#DC3545" stroke-width="2"/>
              </svg>
              <p style="margin-top: 0.5rem; font-size: 0.8rem; color: #DC3545;"><%= t('programs.show.processing_failed') %></p>
            </div>
          <% else %>
            <div class="default-thumbnail">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>
                <polyline points="21,15 16,10 5,21" stroke="currentColor" stroke-width="2"/>
              </svg>
              <p style="margin-top: 0.5rem; font-size: 0.8rem; color: inherit;">
                <%= t("program_types.#{program.kind}") %>
              </p>
            </div>
          <% end %>
        </div>
        <div class="card-overlay">
          <span class="status-badge status-<%= program.status %>">
            <%= t("status.#{program.status}") %>
          </span>
          <span class="chip <%= program.kind %>"><%= t("program_types.#{program.kind}") %></span>
        </div>
      </div>
      
      <div class="card-content">
        <div class="card-meta">
          <span class="language"><%= program.language.upcase %></span>
          <span class="duration">
            <% if program.duration_seconds %>
              <%= time_duration_in_words(program.duration_seconds) %>
            <% else %>
              --:--
            <% end %>
          </span>
        </div>
        
        <h3 class="card-title">
          <%= link_to program.title, cms_program_path(program) %>
        </h3>
        
        <p class="card-description">
          <%= program.description&.truncate(120) || t('programs.index.no_description') %>
        </p>
        
        <div class="card-footer">
          <div class="publish-date">
            <% if program.published_at %>
              <span class="published"><%= t('programs.show.published_on') %> <%= program.published_at.strftime("%d %B %Y") %></span>
            <% else %>
              <span class="unpublished"><%= t('programs.show.not_published') %></span>
            <% end %>
          </div>
          
          <div class="card-actions">
            <%= link_to cms_program_path(program), class: "action-btn view" do %>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
            <% end %>
            
            <%= link_to edit_cms_program_path(program), class: "action-btn edit" do %>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2"/>
                <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
              </svg>
            <% end %>
            
            <% if program.ready? && program.published_at.nil? %>
              <%= form_with url: cms_program_path(program), method: :patch, local: false, class: "publish-form" do |f| %>
                <%= hidden_field_tag "program[published_at]", Time.current %>
                <%= button_tag type: "submit", class: "action-btn publish" do %>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <polygon points="10,8 16,12 10,16" fill="currentColor"/>
                  </svg>
                <% end %>
              <% end %>
            <% end %>
            
            <%= form_with url: cms_program_path(program), method: :delete, local: true, class: "delete-form" do |f| %>
              <%= button_tag type: "submit", class: "action-btn delete", onclick: "return confirm('#{t('common.confirm_delete')}')" do %>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2"/>
                  <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2" stroke="currentColor" stroke-width="2"/>
                </svg>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
  
  <% if @programs.empty? %>
    <div class="empty-state">
      <div class="empty-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="#666" stroke-width="2"/>
          <circle cx="8.5" cy="8.5" r="1.5" fill="#666"/>
          <polyline points="21,15 16,10 5,21" stroke="#666" stroke-width="2"/>
        </svg>
      </div>
      <h3><%= t('programs.index.no_programs') %></h3>
      <p><%= t('programs.index.create_first') %></p>
      <%= link_to t('common.create'), new_cms_program_path, class: "btn" %>
    </div>
  <% end %>
</div>

<style>
  .cms-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 3rem;
  }
  
  .programs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
    direction: rtl;
  }
  
  .program-card {
    background: #FFFFFF;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #E9ECEF;
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }
  
  .program-card:hover {
    transform: translateY(-4px);
    border-color: #00D35B;
    box-shadow: 0 8px 32px rgba(0, 211, 91, 0.15);
  }
  
  .card-image {
    position: relative;
    height: 200px;
    background: #F8F9FA;
    overflow: hidden;
  }
  
  .card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.3s ease;
  }
  
  .placeholder-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #E9ECEF 0%, #F8F9FA 100%);
    color: #ADB5BD;
    flex-direction: column;
    text-align: center;
  }
  
  .processing-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #FFC107;
  }
  
  .error-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .default-thumbnail {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #6C757D;
  }
  
  .card-overlay {
    position: absolute;
    top: 1rem;
    left: 1rem;
    display: flex;
    gap: 0.5rem;
    flex-direction: column;
    align-items: flex-start;
  }
  
  .status-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 16px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.025em;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .status-draft { 
    background: rgba(108, 117, 125, 0.9); 
    color: #FFFFFF; 
  }
  .status-processing { 
    background: rgba(255, 193, 7, 0.9); 
    color: #000000; 
  }
  .status-ready { 
    background: rgba(0, 211, 91, 0.9); 
    color: #FFFFFF; 
  }
  .status-failed { 
    background: rgba(220, 53, 69, 0.9); 
    color: #FFFFFF; 
  }
  
  .card-content {
    padding: 1.5rem;
    direction: rtl;
    text-align: right;
  }
  
  .card-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    font-size: 0.8rem;
    color: #6C757D;
    font-weight: 500;
  }
  
  .language {
    background: rgba(0, 211, 91, 0.1);
    color: #00D35B;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    border: 1px solid rgba(0, 211, 91, 0.3);
  }
  
  .card-title {
    margin-bottom: 0.75rem;
  }
  
  .card-title a {
    color: #212529;
    text-decoration: none;
    font-size: 1.1rem;
    font-weight: 600;
    line-height: 1.4;
    transition: color 0.2s ease;
  }
  
  .card-title a:hover {
    color: #00D35B;
  }
  
  .card-description {
    color: #6C757D;
    font-size: 0.9rem;
    line-height: 1.5;
    margin-bottom: 1.5rem;
    min-height: 3rem;
  }
  
  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid #E9ECEF;
    padding-top: 1rem;
    direction: rtl;
  }
  
  .publish-date {
    font-size: 0.8rem;
  }
  
  .published {
    color: #00D35B;
    font-weight: 500;
  }
  
  .unpublished {
    color: #ADB5BD;
  }
  
  .card-actions {
    display: flex;
    gap: 0.5rem;
    direction: ltr;
  }
  
  .action-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #F8F9FA;
    border: 1px solid #DEE2E6;
    color: #6C757D;
    transition: all 0.2s ease;
    text-decoration: none;
    cursor: pointer;
  }
  
  .action-btn:hover {
    background: #E9ECEF;
    color: #495057;
    border-color: #ADB5BD;
  }
  
  .action-btn.view:hover {
    background: rgba(0, 211, 91, 0.1);
    color: #00D35B;
    border-color: #00D35B;
  }
  
  .action-btn.edit:hover {
    background: rgba(255, 193, 7, 0.1);
    color: #FFC107;
    border-color: #FFC107;
  }
  
  .action-btn.publish:hover {
    background: rgba(0, 211, 91, 0.1);
    color: #00D35B;
    border-color: #00D35B;
  }
  
  .action-btn.delete:hover {
    background: rgba(220, 53, 69, 0.1);
    color: #DC3545;
    border-color: #DC3545;
  }
  
  .publish-form,
  .delete-form {
    display: inline-block;
    margin: 0;
  }
  
  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 2rem;
    background: #FFFFFF;
    border-radius: 12px;
    border: 2px dashed #DEE2E6;
  }
  
  .empty-icon {
    margin-bottom: 1.5rem;
    display: flex;
    justify-content: center;
  }
  
  .empty-state h3 {
    color: #495057;
    margin-bottom: 0.5rem;
    font-size: 1.5rem;
  }
  
  .empty-state p {
    color: #6C757D;
    margin-bottom: 2rem;
    font-size: 1rem;
  }
  
  @media (max-width: 768px) {
    .programs-grid {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    
    .cms-header {
      flex-direction: column;
      gap: 1rem;
      align-items: stretch;
    }
    
    .cms-header h1 {
      text-align: center;
    }
  }
</style>
